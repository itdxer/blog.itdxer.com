I"CN<p>For my <a href="https://github.com/itdxer/neupy">open-source project</a> I write a lot of documentation that I then convert into HTML pages. When project grows it’s difficult to support such amount of documentation. Mostly because there are a lot of copy and paste that occur in the code. To resolve this problem I came up with a solution that I call <strong>Shared Docs</strong>. Before I explain it to you I would like to show you an example of some common problem that happens in the projects that use Python’s documentation.</p>

<h2 id="problem">Problem</h2>

<p>Let’s assume that we need to make a small library. This library is supposed to have a bunch of classes that define people with different professions. Some attributes like person’s name are the same for all classes and some are not. The problem is simple, right? Anyone who knows <a href="https://en.wikipedia.org/wiki/Object-oriented_programming">OOP</a> can make this library easily.</p>

<p>For this problem we need to have a class that will be a base class for all others. We can create a class <code class="highlighter-rouge">Person</code> which have attributes typical for any person with any profession.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">"""
    Person class.

    Parameters
    ----------
    fullname : str
        Full name.
    height : float
        Height in meters (m).
    weight : float
        Weight in kilograms (kg).
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span> <span class="o">=</span> <span class="n">fullname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span></code></pre></figure>

<p>Pretty simple, right? We have the class that identifies a person. We even have documentation that describes person’s properties which is very useful, especially for weight and height parameters, because it’s not really clear what units should we use to define these parameters.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">john</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">fullname</span><span class="o">=</span><span class="s">"John Smith"</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span></code></pre></figure>

<p>But if anyone checks the documentation the one will find all necessary information there. Let’s have a look.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; help(john)
Help on Person in module __main__ object:

class Person(builtins.object)
 |  Person class.
 |
 |  Parameters
 |  ----------
 |  fullname : str
 |      Full name.
 |  height : float
 |      Height in meters (m).
 |  weight : float
 |      Weight in kilograms (kg).
</code></pre></div></div>

<p>Yep, now it’s clear. Everything is defined in metric units.</p>

<p>So far everything works great. We have a class and documentation for it, so anyone can understand it.</p>

<p>Now we need to make a new class that depends on the <code class="highlighter-rouge">Person</code> class. Let it be a Doctor. Doctor is a person, so parameters should be the same as for the <code class="highlighter-rouge">Person</code> class.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Doctor</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="s">"""
    Doctor class.

    Parameters
    ----------
    fullname : str
        Full name.
    height : float
        Height in meters (m).
    weight : float
        Weight in kilograms (kg).
    specialty : list of str
        Doctor's speciality.
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specialty</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Doctor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specialty</span> <span class="o">=</span> <span class="n">specialty</span></code></pre></figure>

<p>The new class has all the same properties and the old one. In addition, I’ve added a property that defines doctor’s specialty. The other properties remain the same without changes.</p>

<p>For a while everything seems to work great until someone decided that we need to change height and weight properties to the imperial units. Now we need to find all places where we defined these stuff as metric units and change them to imperial units. And it feels very annoying when you work in a big project.</p>

<p>It becomes even worse when your project has deadlines. Things become tough when deadline is approaching. No one wants to waste time on documentation updates, because it takes a lot of time and energy to do that. Adding new features and bug fixing are more important.</p>

<p>Simple and obvious solution is not to write documentation at all, but in some cases it’s important. Especially when the whole team is divided into small groups and each group is responsible for a separate component of the project. In that case other groups might be not familiar well enough with some of the components and documentation that explains parts of the unfamiliar components becomes very useful.</p>

<p>One way to approach these problems is Shared Docs.</p>

<h2 id="solution-shared-docs">Solution: Shared Docs</h2>

<p>Python’s documentation is just string and it doesn’t have standardized syntax which means that we need to choose one. Otherwise it will be difficult to identify variables in the documentation. I like <a href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt">NumPy’s documentation style</a> and I use it for all my projects. My Shared Docs implementation works only with NumPy documentation style.</p>

<h3 id="classes">Classes</h3>

<p>Let’s rewrite previous example using Shared Docs.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">neupy.core.docs</span> <span class="kn">import</span> <span class="n">SharedDocs</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">SharedDocs</span><span class="p">):</span>
    <span class="s">"""
    Person class.

    Parameters
    ----------
    fullname : str
        Full name.
    height : float
        Height in meters (m).
    weight : float
        Weight in kilograms (kg).
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span> <span class="o">=</span> <span class="n">fullname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span></code></pre></figure>

<p>The Person class is exactly the same as we have seen before, but now it inherits from the <code class="highlighter-rouge">SharedDocs</code> class. So we need to rewrite the <code class="highlighter-rouge">Doctor</code> class.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Doctor</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="s">"""
    Doctor class.

    Parameters
    ----------
    {Person.fullname}
    {Person.height}
    {Person.weight}
    specialty : list of str
        Doctor's speciality.
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specialty</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Doctor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specialty</span> <span class="o">=</span> <span class="n">specialty</span></code></pre></figure>

<p>This is a place where we start to take an advantage of this approach. As you can see we no longer need to copy and paste the documentation from the parent class. We just reuse it applying simple <a href="https://docs.python.org/3/library/string.html#format-string-syntax">Python format syntax</a>. In this way it’s also seems clear which methods we reuse and from what class we inherit them.</p>

<p>The other way of doing it is just simply inherit all parameters at once.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Doctor</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="s">"""
    Doctor class.

    Parameters
    ----------
    {Person.Parameters}
    specialty : list of str
        Doctor's speciality.
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specialty</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Doctor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specialty</span> <span class="o">=</span> <span class="n">specialty</span></code></pre></figure>

<p>As you can see I just replaced parameters with one variable that contains all parameters from the <code class="highlighter-rouge">Person</code> class. The main point of this variable is to make dynamic updates for the documentation. For instance, if we add a new parameter for the <code class="highlighter-rouge">Person</code> class that defines person’s age, we just need to describe it in the <code class="highlighter-rouge">Person</code> class and the <code class="highlighter-rouge">Doctor</code> class will get it automatically, because it inherits all parameters from the parent class. The main disadvantage is that it’s hard to understand which properties <code class="highlighter-rouge">Doctor</code> has when we read documentation from the code. But in other circumstances you will see properly formatted documentation.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; help(Doctor)
class Doctor(Person)
 |  Doctor class.
 |  
 |  Parameters
 |  ----------
 |  fullname : str
 |      Full name.
 |  height : float
 |      Height in meters (m).
 |  weight : float
 |      Weight in kilograms (kg).
 |  specialty : list of str
 |      Doctor's speciality.
</code></pre></div></div>

<p>So far I have only shown instances where we defined parameters, but Shared Docs can parse other variables like <a href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt#class-docstring">Methods and Attributes</a>. Some sections like Warns or Returns are possible to be re-used as well, but in that case you can use entire section and it wouldn’t be possible to divide it into smaller pieces.</p>

<h3 id="functions">Functions</h3>

<p>Sometimes it’s also useful to inherit documentation for the functions that have similar behavior. Let’s check another example. Just pretend that we try to build HTML page using python functions and we want to use it like this.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">html_page</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span>
    <span class="n">div</span><span class="p">(</span>
        <span class="n">h1</span><span class="p">(</span><span class="s">'Title #1'</span><span class="p">),</span>
        <span class="n">div</span><span class="p">(</span><span class="s">'Some text'</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">div</span><span class="p">(</span>
        <span class="n">h1</span><span class="p">(</span><span class="s">'Title #2'</span><span class="p">),</span>
        <span class="n">div</span><span class="p">(</span><span class="s">'Another text'</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span></code></pre></figure>

<p>Classes are redundant in this situation, so we can use functions. We can make a simple function that creates any opening and closing tags.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">inner_tags</span><span class="p">):</span>
    <span class="s">"""
    Create HTML tag.

    Parameters
    ----------
    name : str
        HTML tag name.
    *inner_tags
        Children tags.
    """</span>
    <span class="k">return</span> <span class="s">"&lt;{tag_name}&gt;{}&lt;/{tag_name}&gt;"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inner_tags</span><span class="p">),</span>
        <span class="n">tag_name</span><span class="o">=</span><span class="n">name</span>
    <span class="p">)</span></code></pre></figure>

<p>This function creates any tag we want. We can create a span tag.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">tag</span><span class="p">(</span><span class="s">'span'</span><span class="p">,</span> <span class="s">'Hello world'</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;</span><span class="n">Hello</span> <span class="n">world</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span></code></pre></figure>

<p>It works, but it’s not a Pythonic way to do it. To make it look better we can define a few functions that will create only a specific tag like <code class="highlighter-rouge">h1</code> or <code class="highlighter-rouge">div</code>.</p>

<p>The HTML tag will have pretty much the same input parameters, which means that we need to make the same parameters description in the documentation. Shared Docs can be useful in this situation too. To get the same ability to inherit documentation from other functions we may use <code class="highlighter-rouge">shared_docs</code> decorator.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">neupy.core.docs</span> <span class="kn">import</span> <span class="n">shared_docs</span>

<span class="o">@</span><span class="n">shared_docs</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">h1</span><span class="p">(</span><span class="o">*</span><span class="n">inner_tags</span><span class="p">):</span>
    <span class="s">"""
    Create level one header tag.

    Parameters
    ----------
    {tag.inner_tags}
    """</span>
    <span class="k">return</span> <span class="n">tag</span><span class="p">(</span><span class="s">'h1'</span><span class="p">,</span> <span class="o">*</span><span class="n">inner_tags</span><span class="p">)</span>

<span class="o">@</span><span class="n">shared_docs</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="o">*</span><span class="n">inner_tags</span><span class="p">):</span>
    <span class="s">"""
    Create div tag.

    Parameters
    ----------
    {tag.inner_tags}
    """</span>
    <span class="k">return</span> <span class="n">tag</span><span class="p">(</span><span class="s">'div'</span><span class="p">,</span> <span class="o">*</span><span class="n">inner_tags</span><span class="p">)</span></code></pre></figure>

<p>And if we check documentation for the one of the classes we will see that everything is formatted properly.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; help(div)
Help on function div in module __main__:

div(*inner_tags)
    Create div tag.

    Parameters
    ----------
    *inner_tags
        Children tags.
</code></pre></div></div>

<p>Documentation has exactly the same syntax as classes. The only main difference is that currently function can inherit just from a single function. It won’t work if you try to wrap function with multiple decorators.</p>

<h2 id="source-code">Source Code</h2>

<p>The main code is available <a href="https://github.com/itdxer/neupy/blob/master/neupy/core/docs.py">at GitHub in the NeuPy repository</a>. It’s pretty simple and almost a standalone script. One dependency is a <code class="highlighter-rouge">AttributeKeyDict</code> class which is really small.</p>

<p>All code from the article you can find in <a href="https://github.com/itdxer/blog.itdxer.com/blob/gh-pages/notebooks/2016-07-25%20Share%20Documentation%20Between%20Classes%20and%20Functions%20in%20Python.ipynb">iPython Notebook</a></p>
:ET